// This macro outputs the following functional forms via:
//
// .L fit_GlauberCuCu_Var_vs_b()
// TF1*f=(TF1*)fit_GlauberCuCu_Var_vs_b()
// emcAnalyzerUtils::dump_function(f)

/*

  TF1 *fCuCu_AT_vs_b = new TF1("fCuCu_AT_vs_b","pol6/([7]+exp((x-[8])/[9]))",0.,12.);
  fCuCu_AT_vs_b->SetParameters(2090.48,17.1399,-60.7199,14.1924,-2.57839,0.24024,-0.00797501,27.3259,-338.954,326.951);
  
  TF1 *fCuCu_Npart_vs_b = new TF1("fCuCu_Npart_vs_b","pol6/([7]+exp((x-[8])/[9]))",0.,13.);
  fCuCu_Npart_vs_b->SetParameters(9653.44,-199.152,-145.226,-29.6131,7.47431,-0.466556,0.00874289,85.095,12.1611,4.44363e-05);
  
  TF1 *fCuCu_Ncoll_vs_b = new TF1("fCuCu_Ncoll_vs_b","pol6/([7]+exp((x-[8])/[9]))",0.,12.);
  fCuCu_Ncoll_vs_b->SetParameters(1804.6,-45.8882,-45.9015,-4.29436,2.10394,-0.189134,0.00550995,9.51589,6.74213,1.03249);

  TF1 *fCuCu_fcc_percentile_vs_b = new TF1("fCuCu_fcc_percentile_vs_b","pol6",0.,13.5);
  fCuCu_fcc_percentile_vs_b->SetParameters(0.0518769,-0.353843,1.58107,-0.370884,0.0773438,-0.00651312,0.000178376);

  TF1 *fCuCu_b_vs_fcc_percentile = new TF1("fCuCu_b_vs_fcc_percentile","pol9",0.,14.);
  fCuCu_b_vs_fcc_percentile->SetParameters(0.241385,0.73515,-0.0857205,0.00664195,-0.000300529,8.17127e-06,-1.35215e-07,1.33171e-09,-7.16985e-12,1.62385e-14);
  

*/

TF1* fit_GlauberCuCu_Var_vs_b( const TString opt = "b_vs_cc", double bfitmin = 0., double bfitmax = 100. )
{

  cout << "<I> OK. I'll compute the fit function of " << opt.Data() 
       << " versus impact parameter (b) ..." << endl 
       << "    Other options are: \"Ncoll\", \"AT\", \"CC\", and \"b_vs_CC\" " << endl;

  const int Ncent = 36;

  // 0-0%,0-1%,1-2%,2-4%, | 1.5-2.5,2.5-3.5,3.5-4.5,4.5-5.,5-5.5% |
  // 0-0.1%,0.1-0.2%,0.2-0.4%
  // 0-5%,5-10%, ... 90-95%,95-100% | 96-97%,97-98%,98-99%,99-100%:

  double cc_percentile[Ncent]={ 0.,0.5,1.5,3.,
			        2.,3.,4.,4.75,5.25,
			        0.05,0.15,0.3,
				2.5,7.5,12.5,17.5,22.5,27.5,32.5,37.5,42.5,47.5,52.5,57.5,
				62.5,67.5,72.5,77.5,82.5,87.5,92.5,97.5,
				96.5,97.5,98.5,99.5};

  double b[Ncent]={ 0.,0.69,1.26,1.81,
		    1.47,1.82,2.09,2.28,2.40,
		    0.23,0.42,0.57,
		    1.56,2.86,3.72,4.40,5.00,5.52,6.00,6.45,6.87,7.26,7.64,8.00,
		    8.34,8.68,9.02,9.36,9.73,10.16,10.72,11.95,
		    11.43,11.73,12.16,13.25};

  // fixme: A = 64 not 57 (!?)

  double Npart[Ncent]={ 2*57.,110.9,107.4,102.7,
			106.0,102.6,99.1,97.2,95.7,
			112.1,112.0,111.6,
			104.3,89.2,76.1,65.1,55.0,46.3,38.9,32.6,26.8,22.0,17.8,14.3,
			11.5,9.2,7.3,5.9,4.9,4.0,3.2,2.6
			2.7,2.6,2.5,2.3};

  double Ncoll[Ncent]={ 190.,183.7,176.0,164.4,
			172.1,163.9,157.3,153.9,148.8,
			187.8,185.8,186.2,
			168.6,136.8,111.0,90.5,72.1,57.9,45.9,36.428.5,28.5,22.0,17.0,12.9,
			9.8,7.5,5.6,4.4,3.5,2.7,2.1,1.5
			1.6,1.5,1.5,1.3};

  double AT[Ncent]={ 14.5,14.385,14.073,13.802,
		     13.991,13.815,13.518,13.288,13.353,
		     14.478,14.477,14.443,
		     13.885,12.701,11.648,10.698,9.909,9.104,8.482,7.901,7.258,6.873,6.347,5.913,
		     5.572,5.244,4.890,4.630,4.502,4.416,4.397,4.5,
		     4.520,4.341,4.3,4.3};

  double Amax = 69.4; // fm^2 normalized area
  double ATnorm[Ncent];

  for (int i=0;i<Ncent;i++)
    {
      ATnorm[i]=AT[i]/AT[0]*Amax;
    }

  double errb[Ncent];
  double errNpart[Ncent];
  double errNcoll[Ncent];
  double errAT[Ncent];
  double errcc_percentile[Ncent];

  // Trick-1: play with the (x,y) errors until you get a decent fit ...
  // Trick-2: play with the fit limits until you get a decent fit ...
  for (int i=0;i<Ncent;i++)
    {
      errb[i]=b[i]*0.03;
      errNpart[i]=Npart[i]*0.01;
      errNcoll[i]=Ncoll[i]*0.01;
      errAT[i]=AT[i]*0.01;
      errcc_percentile[i]=cc_percentile[i]*0.01;
    }


  TGraphErrors *GlauberCuCu_Var_vs_b = 0;
  TF1 *fGlauberCuCu_Var_vs_b = 0;
  TCanvas *c = 0;

  char title[200];

  if (opt.Contains("Npart"))
    {
      GlauberCuCu_Var_vs_b = new TGraphErrors(Ncent,b,Npart,errb,errNpart);
      //TF1 *pol3= new TF1("pol3","pol3",0,8.09466);
      //pol3->SetParameters(381.692,-1.16793,-5.95361,0.288317)
      //fGlauberCuCu_Var_vs_b = new TF1("fGlauberCuCu_Var_vs_b","pol1/([2]+exp(((x-[3])/[4])))*pol1/([7]+exp(((x-[8])/[9])))",bfitmin,bfitmax);
      fGlauberCuCu_Var_vs_b = new TF1("fGlauberCuCu_Var_vs_b","pol6/([7]+exp(((x-[8])/[9])))",bfitmin,bfitmax);
      //fGlauberCuCu_Var_vs_b = new TF1("fGlauberCuCu_Var_vs_b","pol5/([6]+exp((x-[7])/[8]))",bfitmin,bfitmax);
      //fGlauberCuCu_Var_vs_b = new TF1("fGlauberCuCu_Var_vs_b","pol3*(x<8)+pol3/([9]+exp(((x-[10])/[11])))*(x>8)",bfitmin,bfitmax);
      //fGlauberCuCu_Var_vs_b = new TF1("fGlauberCuCu_Var_vs_b","pol1/([2]+exp(((x-[3])/[4])))+pol1/([7]+exp(((x-[8])/[9])))",bfitmin,bfitmax);
      sprintf(title,"fCuCu_Npart_vs_b");
    }
  else if (opt.Contains("Ncoll"))
    {
      GlauberCuCu_Var_vs_b = new TGraphErrors(Ncent,b,Ncoll,errb,errNcoll);
      fGlauberCuCu_Var_vs_b = new TF1("fGlauberCuCu_Var_vs_b","pol6/([7]+exp(((x-[8])/[9])))",bfitmin,bfitmax);
      sprintf(title,"fCuCu_Ncoll_vs_b");
    }
  else if (opt.Contains("AT"))
    {
      GlauberCuCu_Var_vs_b = new TGraphErrors(Ncent,b,ATnorm,errb,errAT);
      fGlauberCuCu_Var_vs_b = new TF1("fGlauberCuCu_Var_vs_b","pol6/([7]+exp(((x-[8])/[9])))",bfitmin,bfitmax);
      sprintf(title,"fCuCu_AT_vs_b");
    }
  else if (opt.Contains("b_vs_cc"))
    {
      GlauberCuCu_Var_vs_b = new TGraphErrors(Ncent,cc_percentile,b,errcc_percentile,errb);
      GlauberCuCu_Var_vs_b->SetMinimum(0.001);
      fGlauberCuCu_Var_vs_b = new TF1("fGlauberCuCu_Var_vs_b","pol9",bfitmin,bfitmax);
      sprintf(title,"fCuCu_b_vs_fcc_percentile");
    }
  else if (opt.Contains("cc"))
    {
      GlauberCuCu_Var_vs_b = new TGraphErrors(Ncent,b,cc_percentile,errb,errcc_percentile);
      GlauberCuCu_Var_vs_b->SetMinimum(0.001);
      fGlauberCuCu_Var_vs_b = new TF1("fGlauberCuCu_Var_vs_b","pol6",bfitmin,bfitmax);
      sprintf(title,"fCuCu_fcc_percentile_vs_b");

      c = new TCanvas(title,title,650,600);
      GlauberCuCu_Var_vs_b->SetMarkerStyle(20);
      GlauberCuCu_Var_vs_b->SetMarkerColor(2);
      GlauberCuCu_Var_vs_b->Draw("AP");
      GlauberCuCu_Var_vs_b->Fit("fGlauberCuCu_Var_vs_b","R");
      fGlauberCuCu_Var_vs_b->SetName(title);
      
      return fGlauberCuCu_Var_vs_b;
    }
  else
    {
      cout << "<E> Don't know this option: " << opt << endl;
      return;
    }

  c = new TCanvas(title,title,650,600);
  GlauberCuCu_Var_vs_b->SetMarkerStyle(20);
  GlauberCuCu_Var_vs_b->SetMarkerColor(2);
  GlauberCuCu_Var_vs_b->Draw("AP");

  const int N = 10; 
  if (N!=fGlauberCuCu_Var_vs_b->GetNpar())
    {
      cout << endl << "<E> Npars fit != Npars func. = " << fGlauberCuCu_Var_vs_b->GetNpar() << endl;
      return;
    }

  //double Npars[N]={1000,-20,-7,-2.,0.5,0,0.,3,10,1.}; // Npart
  //double Npars[N]={10000,-190,-100,-10,3,-0.1,0.0,10,10.,1.}; // Ncoll
  double Npars[N]={2500,-30,2,-1,2.,-1.,0.,10.,10.,1.};
  //double Npars[N]={3000,-30,7,-10,2.,-1.,0.,20.,10.,0.5};
  //fGlauberCuCu_Var_vs_b->SetParameters(2801.61,-30.6665,6.61134,-12.574,2.11156,-0.140449,0.00342081,18.6532,14.2221,0.560879);
  //fGlauberCuCu_Var_vs_b->SetParameters(-10,5,-0.3,0.,-0.0,0,-0,0,-0.,0.);

  fGlauberCuCu_Var_vs_b->SetParameters(Npars);
  GlauberCuCu_Var_vs_b->Fit("fGlauberCuCu_Var_vs_b","R");

  fGlauberCuCu_Var_vs_b->SetName(title);

  return fGlauberCuCu_Var_vs_b;
}


// class     Npart   sys.   Ncoll   sys.    T_AB   sys.       b   sys.    ecc.   sys.
//                   err.           err.           err.           err.           err.

// // 0-0%,0-1%,1-2%,2-4%

//   0-  1%:  110.9   183.7   19.8    0.69   14.385
//   1-  2%:  107.4   176.0   20.0    1.26   14.073
//   2-  4%:  102.7   164.4   20.7    1.81   13.802

// //  1.5-2.5,2.5-3.5,3.5-4.5,4.5-5.,5-5.5% 
//   2-  2%:  106.0   172.1   20.2    1.47   13.991
//   2-  4%:  102.6   163.9   20.5    1.82   13.815
//   4-  4%:   99.1   157.3   21.0    2.09   13.518
//   4-  5%:   97.2   153.9   21.1    2.28   13.288
//   5-  6%:   95.7   148.8   20.6    2.40   13.353

// // 0-0.1%,0.1-0.2%,0.2-0.4%

//   0-  0%:  112.1   187.8   21.5    0.23   14.478
//   0-  0%:  112.0   185.8   18.4    0.42   14.477
//   0-  0%:  111.6   186.2   18.8    0.57   14.443

// // 0-5%,5-10%, ... 90-95%,95-100%

//   0-  5%:  104.3   168.6   22.9    1.56   13.885
//   5- 10%:   89.2   136.8   22.6    2.86   12.701
//  10- 15%:   76.1   111.0   21.5    3.72   11.648
//  15- 20%:   65.1    90.5   20.0    4.40   10.698
//  20- 25%:   55.0    72.1   18.0    5.00    9.909
//  25- 30%:   46.3    57.9   16.5    5.52    9.104
//  30- 35%:   38.9    45.9   14.9    6.00    8.482
//  35- 40%:   32.6    36.4   13.1    6.45    7.901
//  40- 45%:   26.8    28.5   11.4    6.87    7.258
//  45- 50%:   22.0    22.0    9.6    7.26    6.873
//  50- 55%:   17.8    17.0    8.4    7.64    6.347
//  55- 60%:   14.3    12.9    7.1    8.00    5.913
//  60- 65%:   11.5     9.8    5.9    8.34    5.572
//  65- 70%:    9.2     7.5    4.9    8.68    5.244
//  70- 75%:    7.3     5.6    3.9    9.02    4.890
//  75- 80%:    5.9     4.4    3.2    9.36    4.630
//  80- 85%:    4.9     3.5    2.6    9.73    4.502
//  85- 90%:    4.0     2.7    2.0   10.16    4.416
//  90- 95%:    3.2     2.1    1.5   10.72    4.397
//  95-100%:    2.6     1.5    1.0   11.95    4.722

// // 96-97%,97-98%,98-99%,99-100%:

//  96- 97%:    2.7     1.6    1.0   11.43    4.520
//  97- 98%:    2.6     1.5    0.9   11.73    4.341
//  98- 99%:    2.5     1.5    0.9   12.16    4.852
//  99-100%:    2.3     1.3    0.7   13.25    5.361


// class     Npart   sys.   Ncoll   sys.    T_AB   sys.       b   sys.    ecc.   sys.
//                   err.           err.           err.           err.           err.

//  0- 10%    93.3    2.6   152.3   17.6    4.28   0.44     2.5    0.2   0.041  0.009
// 10- 20%    71.1    2.4   105.5   12.2    2.96   0.31     4.0    0.2   0.096  0.020
// 20- 30%    51.3    2.0    67.8    8.4    1.90   0.22     5.2    0.3   0.145  0.022
// 30- 40%    36.2    1.8    42.6    5.4    1.20   0.14     6.1    0.3   0.180  0.031
// 40- 50%    24.9    1.5    26.2    3.5    0.74   0.09     6.9    0.4   0.202  0.043
// 50- 60%    16.1    0.9    15.0    1.7    0.42   0.04     7.8    0.4   0.214  0.056
// 60- 88%     7.0    0.7     5.5    0.8    0.15   0.02     9.1    0.4   0.209  0.074

//  0- 20%    82.1    2.4   128.8   14.4    3.62   0.36     3.2    0.2   0.069  0.014
// 20- 40%    43.8    1.9    55.3    6.6    1.55   0.17     5.6    0.3   0.163  0.026
// 40- 60%    20.3    1.3    20.4    2.6    0.57   0.07     7.4    0.4   0.208  0.049
// 60- 88%     7.0    0.7     5.5    0.8    0.15   0.02     9.1    0.4   0.209  0.074

//  0- 30%    71.8    2.4   108.4   12.9    3.04   0.32     3.9    0.2   0.094  0.017
// 30- 60%    25.4    1.6    27.5    3.7    0.77   0.10     7.0    0.4   0.199  0.043
// 60- 88%     7.0    0.7     5.5    0.8    0.15   0.02     9.1    0.4   0.209  0.074

// 00- 88%    35.3    1.8    47.9    5.7    1.35   0.15     6.6    0.4   0.167  0.044

// PC1 cut    centr.   Npart    sys.  Ncoll   sys.    TAB    sys.      b    sys.    ecc.  sys. 
//                              err.          err.           err.           err.          err.

// N>=53      0-  5%    98.2    2.0   152.7   16.5    4.73   0.44     2.0    0.1   0.028  0.010
// 53>N>=44   5- 10%    85.9    2.2   128.1   12.3    3.97   0.34     2.9    0.2   0.060  0.018
// 44>N>=30  10- 20%    67.8    3.1    93.6    9.4    2.90   0.28     4.0    0.3   0.103  0.021
// 30>N>=14  20- 40%    41.0    3.6    48.4    6.5    1.50   0.21     5.7    0.3   0.172  0.030
// 14>N>= 9  40- 50%    23.1    3.3    22.9    4.4    0.71   0.14     7.0    0.4   0.207  0.038
//  9>N>= 0  50-100%     8.8    1.6     7.3    1.7    0.23   0.05     8.8    0.5   0.213  0.069

// N>=44      0- 10%    92.2    2.2   140.7   14.8    4.36   0.40     2.4    0.1   0.044  0.013 
// 44>N>=21  10- 30%    58.6    3.2    77.6    8.1    2.40   0.25     4.6    0.3   0.128  0.023 
// 21>N>= 6  30- 60%    24.9    3.2    25.9    4.5    0.80   0.14     6.9    0.4   0.203  0.041 
//  6>N>= 0  60-100%     6.5    1.3     5.0    1.2    0.15   0.04     9.1    0.5   0.212  0.073 


// Note that the eccentricity is calculated in the old way with fixed
// center-of-gravity and reference frame. A better defintion of the
// eccentricity is subject to ongoing discussions.

// Klaus Reygers, Dec. 16, 2005


// // 0-0%,0-1%,1-2%,2-4%

//   0-  1%:  110.9    0.1    4.9   183.7    0.5   19.8    0.69    0.0    0.2   0.003  0.003  0.110  14.385  0.037  1.363  
//   1-  2%:  107.4    0.1    5.5   176.0    0.5   20.0    1.26    0.0    0.1   0.017  0.003  0.119  14.073  0.037  1.388  
//   2-  4%:  102.7    0.1    6.4   164.4    0.4   20.7    1.81    0.0    0.2   0.025  0.002  0.126  13.802  0.027  1.422  

// //  1.5-2.5,2.5-3.5,3.5-4.5,4.5-5.,5-5.5% 
//   2-  2%:  106.0    0.2    5.7   172.1    0.5   20.2    1.47    0.0    0.1   0.017  0.003  0.121  13.991  0.037  1.383  
//   2-  4%:  102.6    0.2    6.3   163.9    0.6   20.5    1.82    0.0    0.1   0.026  0.003  0.125  13.815  0.038  1.425  
//   4-  4%:   99.1    0.2    6.6   157.3    0.6   21.0    2.09    0.0    0.1   0.035  0.004  0.132  13.518  0.039  1.451  
//   4-  5%:   97.2    0.3    6.7   153.9    0.8   21.1    2.28    0.0    0.0   0.049  0.005  0.132  13.288  0.058  1.530  
//   5-  6%:   95.7    0.3    7.2   148.8    0.8   20.6    2.40    0.0    0.0   0.041  0.005  0.136  13.353  0.057  1.507  

// // 0-0.1%,0.1-0.2%,0.2-0.4%

//   0-  0%:  112.1    0.4    4.3   187.8    1.8   21.5    0.23    0.0    0.1  -0.003  0.009  0.110  14.478  0.107  1.256  
//   0-  0%:  112.0    0.4    4.3   185.8    1.6   18.4    0.42    0.0    0.0  -0.004  0.009  0.108  14.477  0.117  1.361  
//   0-  0%:  111.6    0.3    4.8   186.2    1.1   18.8    0.57    0.0    0.1   0.010  0.007  0.112  14.443  0.080  1.334  

// // 0-5%,5-10%, ... 90-95%,95-100%

//   0-  5%:  104.3    0.1    7.6   168.6    0.3   22.9    1.56    0.0    0.6   0.023  0.001  0.124  13.885  0.018  1.462  
//   5- 10%:   89.2    0.1    8.7   136.8    0.3   22.6    2.86    0.0    0.3   0.070  0.002  0.147  12.701  0.019  1.608  
//  10- 15%:   76.1    0.1    9.0   111.0    0.3   21.5    3.72    0.0    0.2   0.110  0.002  0.168  11.648  0.021  1.720  
//  15- 20%:   65.1    0.1    9.1    90.5    0.2   20.0    4.40    0.0    0.2   0.141  0.002  0.190  10.698  0.022  1.842  
//  20- 25%:   55.0    0.1    9.0    72.1    0.2   18.0    5.00    0.0    0.2   0.174  0.003  0.209   9.909  0.024  1.988  
//  25- 30%:   46.3    0.1    8.9    57.9    0.2   16.5    5.52    0.0    0.1   0.204  0.003  0.231   9.104  0.025  2.090  
//  30- 35%:   38.9    0.1    8.8    45.9    0.2   14.9    6.00    0.0    0.1   0.223  0.003  0.256   8.482  0.027  2.243  
//  35- 40%:   32.6    0.1    8.4    36.4    0.2   13.1    6.45    0.0    0.1   0.234  0.003  0.283   7.901  0.029  2.394  
//  40- 45%:   26.8    0.1    7.8    28.5    0.1   11.4    6.87    0.0    0.1   0.258  0.004  0.312   7.258  0.030  2.519  
//  45- 50%:   22.0    0.1    7.2    22.0    0.1    9.6    7.26    0.0    0.1   0.263  0.004  0.340   6.873  0.033  2.742  
//  50- 55%:   17.8    0.1    6.8    17.0    0.1    8.4    7.64    0.0    0.1   0.273  0.004  0.371   6.347  0.035  2.950  
//  55- 60%:   14.3    0.1    6.1    12.9    0.1    7.1    8.00    0.0    0.1   0.276  0.005  0.402   5.913  0.037  3.108  
//  60- 65%:   11.5    0.1    5.4     9.8    0.1    5.9    8.34    0.0    0.1   0.275  0.005  0.436   5.572  0.042  3.491  
//  65- 70%:    9.2    0.1    4.8     7.5    0.1    4.9    8.68    0.0    0.1   0.259  0.006  0.468   5.244  0.044  3.645  
//  70- 75%:    7.3    0.0    4.1     5.6    0.0    3.9    9.02    0.0    0.1   0.264  0.006  0.496   4.890  0.046  3.837  
//  75- 80%:    5.9    0.0    3.4     4.4    0.0    3.2    9.36    0.0    0.1   0.258  0.006  0.521   4.630  0.048  3.959  
//  80- 85%:    4.9    0.0    2.9     3.5    0.0    2.6    9.73    0.0    0.1   0.227  0.007  0.548   4.502  0.051  4.237  
//  85- 90%:    4.0    0.0    2.2     2.7    0.0    2.0   10.16    0.0    0.1   0.203  0.007  0.573   4.416  0.055  4.621  
//  90- 95%:    3.2    0.0    1.7     2.1    0.0    1.5   10.72    0.0    0.2   0.165  0.007  0.590   4.397  0.058  4.822  
//  95-100%:    2.6    0.0    1.1     1.5    0.0    1.0   11.95    0.0    0.8   0.084  0.008  0.632   4.722  0.067  5.563  

// // 96-97%,97-98%,98-99%,99-100%:

//  96- 97%:    2.7    0.0    1.2     1.6    0.0    1.0   11.43    0.0    0.1   0.156  0.017  0.622   4.520  0.143  5.316  
//  97- 98%:    2.6    0.0    1.0     1.5    0.0    0.9   11.73    0.0    0.1   0.100  0.017  0.628   4.341  0.134  4.993  
//  98- 99%:    2.5    0.0    0.9     1.5    0.0    0.9   12.16    0.0    0.2   0.074  0.017  0.633   4.852  0.155  5.756  
//  99-100%:    2.3    0.0    0.8     1.3    0.0    0.7   13.25    0.0    0.8  -0.053  0.017  0.645   5.361  0.167  6.215  
