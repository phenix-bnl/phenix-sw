<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>/trees/alex/src/libodbc++/include/odbc++/types.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.14 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; </center>
<hr><h1>/trees/alex/src/libodbc++/include/odbc++/types.h</h1><div class="fragment"><pre>00001 <font class="comment">/* </font>
00002 <font class="comment">   This file is part of libodbc++.</font>
00003 <font class="comment">   </font>
00004 <font class="comment">   Copyright (C) 1999-2000 Manush Dodunekov &lt;manush@stendahls.net&gt;</font>
00005 <font class="comment">   </font>
00006 <font class="comment">   This library is free software; you can redistribute it and/or</font>
00007 <font class="comment">   modify it under the terms of the GNU Library General Public</font>
00008 <font class="comment">   License as published by the Free Software Foundation; either</font>
00009 <font class="comment">   version 2 of the License, or (at your option) any later version.</font>
00010 <font class="comment">   </font>
00011 <font class="comment">   This library is distributed in the hope that it will be useful,</font>
00012 <font class="comment">   but WITHOUT ANY WARRANTY; without even the implied warranty of</font>
00013 <font class="comment">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</font>
00014 <font class="comment">   Library General Public License for more details.</font>
00015 <font class="comment">   </font>
00016 <font class="comment">   You should have received a copy of the GNU Library General Public License</font>
00017 <font class="comment">   along with this library; see the file COPYING.  If not, write to</font>
00018 <font class="comment">   the Free Software Foundation, Inc., 59 Temple Place - Suite 330,</font>
00019 <font class="comment">   Boston, MA 02111-1307, USA.</font>
00020 <font class="comment">*/</font>
00021 
00022 <font class="preprocessor">#ifndef __ODBCXX_TYPES_H</font>
00023 <font class="preprocessor"></font><font class="preprocessor">#define __ODBCXX_TYPES_H</font>
00024 <font class="preprocessor"></font>
00025 <font class="preprocessor">#include &lt;odbc++/setup.h&gt;</font>
00026 
00027 <font class="preprocessor">#include &lt;exception&gt;</font>
00028 
00029 <font class="preprocessor">#if !defined(ODBCXX_QT)</font>
00030 <font class="preprocessor"></font><font class="preprocessor"># include &lt;string&gt;</font>
00031 <font class="preprocessor"># else</font>
00032 <font class="preprocessor"></font><font class="preprocessor"># include &lt;qstring.h&gt;</font>
00033 <font class="preprocessor">#endif</font>
00034 <font class="preprocessor"></font>
00035 <font class="preprocessor">#include &lt;ctime&gt;</font>
00036 <font class="preprocessor">#if defined(ODBCXX_NO_STD_TIME_T)</font>
00037 <font class="preprocessor"></font><font class="keyword">namespace </font>std {
00038   using ::time_t;
00039 };
00040 <font class="preprocessor">#endif</font>
00041 <font class="preprocessor"></font>
00042 <font class="preprocessor">#if defined(ODBCXX_QT)</font>
00043 <font class="preprocessor"></font><font class="keyword">class </font>QIODevice;
00044 <font class="preprocessor">#endif</font>
00045 <font class="preprocessor"></font>
00046 <font class="preprocessor">#if defined(ODBCXX_HAVE_ISQL_H) &amp;&amp; defined(ODBCXX_HAVE_ISQLEXT_H)</font>
00047 <font class="preprocessor"></font><font class="preprocessor"># include &lt;isql.h&gt;</font>
00048 <font class="preprocessor"># include &lt;isqlext.h&gt;</font>
00049 <font class="preprocessor">#elif defined(ODBCXX_HAVE_SQL_H) &amp;&amp; defined(ODBCXX_HAVE_SQLEXT_H)</font>
00050 <font class="preprocessor"></font><font class="preprocessor"># include &lt;sql.h&gt;</font>
00051 <font class="preprocessor"># include &lt;sqlext.h&gt;</font>
00052 <font class="preprocessor">#else</font>
00053 <font class="preprocessor"></font><font class="preprocessor"># error "Whoops. Can not recognize the ODBC subsystem."</font>
00054 <font class="preprocessor"></font><font class="preprocessor">#endif</font>
00055 <font class="preprocessor"></font>
00056 <font class="preprocessor">#if defined(ODBCXX_HAVE_SQLUCODE_H)</font>
00057 <font class="preprocessor"></font><font class="preprocessor"># include &lt;sqlucode.h&gt;</font>
00058 <font class="preprocessor">#endif</font>
00059 <font class="preprocessor"></font>
00060 <font class="comment">// fixups for current iODBC, which kindly doesn't provide SQL_TRUE and</font>
00061 <font class="comment">// SQL_FALSE macros</font>
00062 
00063 <font class="preprocessor">#if !defined(SQL_TRUE)</font>
00064 <font class="preprocessor"></font><font class="preprocessor"># define SQL_TRUE 1</font>
00065 <font class="preprocessor"></font><font class="preprocessor">#endif</font>
00066 <font class="preprocessor"></font>
00067 <font class="preprocessor">#if !defined(SQL_FALSE)</font>
00068 <font class="preprocessor"></font><font class="preprocessor"># define SQL_FALSE 0</font>
00069 <font class="preprocessor"></font><font class="preprocessor">#endif</font>
00070 <font class="preprocessor"></font>
00071 <font class="comment">// MS ODBC SDK misses this in some releases</font>
00072 <font class="preprocessor">#if ODBCVER &gt;= 0x0300 &amp;&amp; !defined(SQL_NOT_DEFERRABLE)</font>
00073 <font class="preprocessor"></font><font class="preprocessor"># define SQL_NOT_DEFERRABLE 7</font>
00074 <font class="preprocessor"></font><font class="preprocessor">#endif</font>
00075 <font class="preprocessor"></font>
00076 
00077 <font class="comment">// Setup our ODBC3_C (odbc3 conditional) macro</font>
00078 <font class="preprocessor">#if ODBCVER &gt;= 0x0300</font>
00079 <font class="preprocessor"></font>
00080 <font class="preprocessor"># define ODBC3_C(odbc3_value,old_value) odbc3_value</font>
00081 <font class="preprocessor"></font>
00082 <font class="preprocessor">#else</font>
00083 <font class="preprocessor"></font>
00084 <font class="preprocessor"># define ODBC3_C(odbc3_value,old_value) old_value</font>
00085 <font class="preprocessor"></font>
00086 <font class="preprocessor">#endif</font>
00087 <font class="preprocessor"></font>
00088 
00089 <font class="comment">// ODBC3_DC (odbc3 dynamic conditional)</font>
00090 <font class="comment">// Every context using this macro should provide</font>
00091 <font class="comment">// a this-&gt;_getDriverInfo() method returning</font>
00092 <font class="comment">// a const DriverInfo*</font>
00093 
00094 <font class="preprocessor">#if ODBCVER &gt;= 0x0300</font>
00095 <font class="preprocessor"></font>
00096 <font class="preprocessor"># define ODBC3_DC(odbc3_value,old_value) \</font>
00097 <font class="preprocessor">(this-&gt;_getDriverInfo()-&gt;getMajorVersion()&gt;=3?odbc3_value:old_value)</font>
00098 <font class="preprocessor"></font>
00099 <font class="preprocessor">#else</font>
00100 <font class="preprocessor"></font>
00101 <font class="preprocessor"># define ODBC3_DC(odbc3_value,old_value) old_value</font>
00102 <font class="preprocessor"></font>
00103 <font class="preprocessor">#endif</font>
00104 <font class="preprocessor"></font>
00105 <font class="preprocessor">#if defined(ODBCXX_HAVE_INTTYPES_H)</font>
00106 <font class="preprocessor"></font><font class="preprocessor"># include &lt;inttypes.h&gt;</font>
00107 <font class="preprocessor">#endif</font>
00108 <font class="preprocessor"></font>
00109 <font class="preprocessor">#include &lt;vector&gt;</font>
00110 
00111 
00112 <font class="keyword">namespace </font>odbc {
00113 
00114   <font class="comment">// We want Long to be at least 64 bits</font>
00115 
00116 <font class="preprocessor">#if defined(WIN32)</font>
00117 <font class="preprocessor"></font>  
00118   <font class="keyword">typedef</font> __int64 Long;
00119 
00120 <font class="preprocessor">#elif defined(ODBCXX_HAVE_INTTYPES_H)</font>
00121 <font class="preprocessor"></font>
00122   <font class="keyword">typedef</font> int64_t Long;
00123 
00124 <font class="preprocessor">#else</font>
00125 <font class="preprocessor"></font>
00126 <font class="preprocessor"># if ODBCXX_SIZEOF_INT == 8</font>
00127 <font class="preprocessor"></font>
00128   <font class="keyword">typedef</font> <font class="keywordtype">int</font> Long;
00129 
00130 <font class="preprocessor"># elif ODBCXX_SIZEOF_LONG == 8</font>
00131 <font class="preprocessor"></font>  
00132   <font class="keyword">typedef</font> <font class="keywordtype">long</font> Long;
00133 
00134 <font class="preprocessor"># elif ODBCXX_SIZEOF_LONG_LONG == 8</font>
00135 <font class="preprocessor"></font>
00136   <font class="keyword">typedef</font> <font class="keywordtype">long</font> <font class="keywordtype">long</font> Long;
00137 
00138 <font class="preprocessor"># else</font>
00139 <font class="preprocessor"></font>  
00140 <font class="preprocessor">#  error "Can't find an appropriate at-least-64-bit integer"</font>
00141 <font class="preprocessor"></font>
00142 <font class="preprocessor"># endif</font>
00143 <font class="preprocessor"></font>
00144 <font class="preprocessor">#endif</font>
00145 <font class="preprocessor"></font>
00146 
00147   <font class="comment">//constants:</font>
00148   <font class="comment">//how much we try to fetch with each SQLGetData call</font>
00149   <font class="keyword">const</font> <font class="keywordtype">int</font> GETDATA_CHUNK_SIZE=4*1024;
00150   <font class="comment">//how much we write with each SQLPutData call</font>
00151   <font class="keyword">const</font> <font class="keywordtype">int</font> PUTDATA_CHUNK_SIZE=GETDATA_CHUNK_SIZE;
00152 
00153   <font class="comment">//how much we read/write in string&lt;-&gt;stream conversion</font>
00154   <font class="comment">//better names for those?</font>
00155   <font class="keyword">const</font> <font class="keywordtype">int</font> STRING_TO_STREAM_CHUNK_SIZE=1024;
00156   <font class="keyword">const</font> <font class="keywordtype">int</font> STREAM_TO_STRING_CHUNK_SIZE=STRING_TO_STREAM_CHUNK_SIZE;
00157 
00158 
00159 
00160 
00161 
<a name="l00164"></a><a class="code" href="structodbc_1_1_types.html">00164</a>   <font class="keyword">struct </font>Types {
<a name="l00167"></a><a class="code" href="structodbc_1_1_types.html#s19">00167</a>     <font class="keyword">enum</font> <a class="code" href="structodbc_1_1_types.html#s19">SQLType</a> {
00169       <a class="code" href="structodbc_1_1_types.html#s19s0">BIGINT</a>            = SQL_BIGINT, 
00171       <a class="code" href="structodbc_1_1_types.html#s19s1">BINARY</a>            = SQL_BINARY,
00173       <a class="code" href="structodbc_1_1_types.html#s19s2">BIT</a>               = SQL_BIT,
00175       <a class="code" href="structodbc_1_1_types.html#s19s3">CHAR</a>              = SQL_CHAR,
00177       <a class="code" href="structodbc_1_1_types.html#s19s4">DATE</a>              = ODBC3_C(SQL_TYPE_DATE,SQL_DATE),
00179       <a class="code" href="structodbc_1_1_types.html#s19s5">DECIMAL</a>           = SQL_DECIMAL,
00181       <a class="code" href="structodbc_1_1_types.html#s19s6">DOUBLE</a>            = SQL_DOUBLE,
00183       <a class="code" href="structodbc_1_1_types.html#s19s7">FLOAT</a>             = SQL_FLOAT,
00185       <a class="code" href="structodbc_1_1_types.html#s19s8">INTEGER</a>           = SQL_INTEGER,
00187       <a class="code" href="structodbc_1_1_types.html#s19s9">LONGVARBINARY</a>     = SQL_LONGVARBINARY,
00189       <a class="code" href="structodbc_1_1_types.html#s19s10">LONGVARCHAR</a>       = SQL_LONGVARCHAR,
00191       <a class="code" href="structodbc_1_1_types.html#s19s11">NUMERIC</a>           = SQL_NUMERIC,
00193       <a class="code" href="structodbc_1_1_types.html#s19s12">REAL</a>              = SQL_REAL,
00195       <a class="code" href="structodbc_1_1_types.html#s19s13">SMALLINT</a>          = SQL_SMALLINT,
00197       <a class="code" href="structodbc_1_1_types.html#s19s14">TIME</a>              = ODBC3_C(SQL_TYPE_TIME,SQL_TIME),
00199       <a class="code" href="structodbc_1_1_types.html#s19s15">TIMESTAMP</a>         = ODBC3_C(SQL_TYPE_TIMESTAMP,SQL_TIMESTAMP),
00201       <a class="code" href="structodbc_1_1_types.html#s19s16">TINYINT</a>           = SQL_TINYINT,
00203       <a class="code" href="structodbc_1_1_types.html#s19s17">VARBINARY</a>         = SQL_VARBINARY,
00205       <a class="code" href="structodbc_1_1_types.html#s19s18">VARCHAR</a>           = SQL_VARCHAR
00206 <font class="preprocessor">#if defined(ODBCXX_HAVE_SQLUCODE_H)</font>
00207 <font class="preprocessor"></font>      ,
00209       WVARCHAR          = SQL_WCHAR,
00211       WCHAR          = SQL_WVARCHAR,
00213       WLONGVARCHAR   = SQL_WLONGVARCHAR
00214 <font class="preprocessor">#endif</font>
00215 <font class="preprocessor"></font>    };
00216   };
00217 
00218 
00219 <font class="preprocessor">#if !defined(ODBCXX_QT)</font>
00220 <font class="preprocessor"></font>
<a name="l00226"></a><a class="code" href="classodbc_1_1_bytes.html">00226</a>   <font class="keyword">class </font>ODBCXX_EXPORT Bytes {
00227   <font class="keyword">private</font>:
00228     <font class="keyword">struct </font>Rep {
00229       <font class="keywordtype">signed</font> <font class="keywordtype">char</font>* buf_;
00230       size_t len_;
00231       <font class="keywordtype">int</font> refCount_;
00232       Rep(<font class="keyword">const</font> <font class="keywordtype">signed</font> <font class="keywordtype">char</font>* b, size_t l)
00233         :len_(l), refCount_(0) {
00234         <font class="keywordflow">if</font>(len_&gt;0) {
00235           buf_=<font class="keyword">new</font> <font class="keywordtype">signed</font> <font class="keywordtype">char</font>[len_];
00236           memcpy((<font class="keywordtype">void</font>*)buf_,(<font class="keywordtype">void</font>*)b,len_);
00237         } <font class="keywordflow">else</font> {
00238           buf_=NULL;
00239         }
00240       }
00241       ~Rep() {
00242         <font class="keyword">delete</font> [] buf_;
00243       }
00244     };
00245 
00246     Rep* rep_;
00247   <font class="keyword">public</font>:
<a name="l00249"></a><a class="code" href="classodbc_1_1_bytes.html#a0">00249</a>     Bytes()
00250       :rep_(new Rep(NULL,0)) {
00251       rep_-&gt;refCount_++;
00252     }
00253 
<a name="l00255"></a><a class="code" href="classodbc_1_1_bytes.html#a1">00255</a>     Bytes(<font class="keyword">const</font> <font class="keywordtype">signed</font> <font class="keywordtype">char</font>* data, size_t dataLen)
00256       :rep_(new Rep(data,dataLen)) {
00257       rep_-&gt;refCount_++;
00258     }
00259 
<a name="l00261"></a><a class="code" href="classodbc_1_1_bytes.html#a2">00261</a>     Bytes(<font class="keyword">const</font> Bytes&amp; b)
00262       :rep_(b.rep_) {
00263       rep_-&gt;refCount_++;
00264     }
00265 
<a name="l00267"></a><a class="code" href="classodbc_1_1_bytes.html#a3">00267</a>     Bytes&amp; operator=(<font class="keyword">const</font> Bytes&amp; b) {
00268       <font class="keywordflow">if</font>(--rep_-&gt;refCount_==0) {
00269         <font class="keyword">delete</font> rep_;
00270       }
00271       rep_=b.rep_;
00272       rep_-&gt;refCount_++;
00273       <font class="keywordflow">return</font> *<font class="keyword">this</font>;
00274     }
00275     
<a name="l00277"></a><a class="code" href="classodbc_1_1_bytes.html#a4">00277</a>     ~Bytes() { 
00278       <font class="keywordflow">if</font>(--rep_-&gt;refCount_==0) {
00279         <font class="keyword">delete</font> rep_;
00280       }
00281     }
00282 
<a name="l00284"></a><a class="code" href="classodbc_1_1_bytes.html#a5">00284</a>     <font class="keyword">const</font> <font class="keywordtype">signed</font> <font class="keywordtype">char</font>* getData()<font class="keyword"> const </font>{ 
00285       <font class="keywordflow">return</font> rep_-&gt;buf_;
00286     }
00287 
<a name="l00289"></a><a class="code" href="classodbc_1_1_bytes.html#a6">00289</a>     size_t getSize()<font class="keyword"> const </font>{
00290       <font class="keywordflow">return</font> rep_-&gt;len_;
00291     }
00292   };
00293 <font class="preprocessor">#endif</font>
00294 <font class="preprocessor"></font>
<a name="l00296"></a><a class="code" href="classodbc_1_1_date.html">00296</a>   <font class="keyword">class </font>ODBCXX_EXPORT Date {
00297   <font class="keyword">protected</font>:
00298     <font class="keywordtype">int</font> year_;
00299     <font class="keywordtype">int</font> month_;
00300     <font class="keywordtype">int</font> day_;
00301 
00302     <font class="keyword">virtual</font> <font class="keywordtype">void</font> _invalid(<font class="keyword">const</font> <font class="keywordtype">char</font>* what, <font class="keywordtype">int</font> value);
00303 
00304     <font class="keywordtype">int</font> _validateYear(<font class="keywordtype">int</font> y) {
00305       <font class="keywordflow">return</font> y;
00306     }
00307     
00308     <font class="keywordtype">int</font> _validateMonth(<font class="keywordtype">int</font> m) {
00309       <font class="keywordflow">if</font>(m&lt;1 || m&gt;12) {
00310         this-&gt;_invalid(<font class="stringliteral">"month"</font>,m);
00311       }
00312       <font class="keywordflow">return</font> m;
00313     }
00314     
00315     <font class="keywordtype">int</font> _validateDay(<font class="keywordtype">int</font> d) {
00316       <font class="keywordflow">if</font>(d&lt;1 || d&gt;31) {
00317         this-&gt;_invalid(<font class="stringliteral">"day"</font>,d);
00318       }
00319       <font class="keywordflow">return</font> d;
00320     }
00321 
00322   <font class="keyword">public</font>:
<a name="l00325"></a><a class="code" href="classodbc_1_1_date.html#a0">00325</a>     Date(<font class="keywordtype">int</font> year, <font class="keywordtype">int</font> month, <font class="keywordtype">int</font> day) {
00326       this-&gt;setYear(year);
00327       this-&gt;setMonth(month);
00328       this-&gt;setDay(day);
00329     }
00330 
00335     <font class="keyword">explicit</font> Date();
00336 
<a name="l00341"></a><a class="code" href="classodbc_1_1_date.html#a2">00341</a>     Date(std::time_t t) {
00342       this-&gt;setTime(t);
00343     }
00344 
<a name="l00349"></a><a class="code" href="classodbc_1_1_date.html#a3">00349</a>     Date(<font class="keyword">const</font> ODBCXX_STRING&amp; str) {
00350       this-&gt;parse(str);
00351     }
00352 
<a name="l00354"></a><a class="code" href="classodbc_1_1_date.html#a4">00354</a>     Date(<font class="keyword">const</font> Date&amp; d)
00355       :year_(d.year_),
00356        month_(d.month_),
00357        day_(d.day_) {}
00358 
<a name="l00360"></a><a class="code" href="classodbc_1_1_date.html#a5">00360</a>     Date&amp; operator=(<font class="keyword">const</font> Date&amp; d) {
00361       year_=d.year_;
00362       month_=d.month_;
00363       day_=d.day_;
00364       <font class="keywordflow">return</font> *<font class="keyword">this</font>;
00365     }
00366 
<a name="l00368"></a><a class="code" href="classodbc_1_1_date.html#a6">00368</a>     <font class="keyword">virtual</font> ~Date() {}
00369 
00371     <font class="keyword">virtual</font> <font class="keywordtype">void</font> setTime(std::time_t t);
00372 
00374     std::time_t getTime() <font class="keyword">const</font>;
00375 
00377     <font class="keywordtype">void</font> parse(<font class="keyword">const</font> ODBCXX_STRING&amp; str);
00378 
<a name="l00380"></a><a class="code" href="classodbc_1_1_date.html#a10">00380</a>     <font class="keywordtype">int</font> getYear()<font class="keyword"> const </font>{
00381       <font class="keywordflow">return</font> year_;
00382     }
00383 
<a name="l00385"></a><a class="code" href="classodbc_1_1_date.html#a11">00385</a>     <font class="keywordtype">int</font> getMonth()<font class="keyword"> const </font>{
00386       <font class="keywordflow">return</font> month_;
00387     }
00388 
<a name="l00390"></a><a class="code" href="classodbc_1_1_date.html#a12">00390</a>     <font class="keywordtype">int</font> getDay()<font class="keyword"> const </font>{
00391       <font class="keywordflow">return</font> day_;
00392     }
00393 
<a name="l00395"></a><a class="code" href="classodbc_1_1_date.html#a13">00395</a>     <font class="keywordtype">void</font> setYear(<font class="keywordtype">int</font> year) {
00396       year_=this-&gt;_validateYear(year);
00397     }
00398 
<a name="l00400"></a><a class="code" href="classodbc_1_1_date.html#a14">00400</a>     <font class="keywordtype">void</font> setMonth(<font class="keywordtype">int</font> month) {
00401       month_=this-&gt;_validateMonth(month);
00402     }
00403 
<a name="l00405"></a><a class="code" href="classodbc_1_1_date.html#a15">00405</a>     <font class="keywordtype">void</font> setDay(<font class="keywordtype">int</font> day) {
00406       day_=this-&gt;_validateDay(day);
00407     }
00408 
00410     <font class="keyword">virtual</font> ODBCXX_STRING toString() <font class="keyword">const</font>;
00411   };
00412 
<a name="l00414"></a><a class="code" href="classodbc_1_1_time.html">00414</a>   <font class="keyword">class </font>ODBCXX_EXPORT Time {
00415   <font class="keyword">protected</font>:
00416     <font class="keywordtype">int</font> hour_;
00417     <font class="keywordtype">int</font> minute_;
00418     <font class="keywordtype">int</font> second_;
00419 
00420     <font class="keyword">virtual</font> <font class="keywordtype">void</font> _invalid(<font class="keyword">const</font> <font class="keywordtype">char</font>* what, <font class="keywordtype">int</font> value);
00421 
00422     <font class="keywordtype">int</font> _validateHour(<font class="keywordtype">int</font> h) {
00423       <font class="keywordflow">if</font>(h&lt;0 || h&gt;23) {
00424         this-&gt;_invalid(<font class="stringliteral">"hour"</font>,h);
00425       }
00426       <font class="keywordflow">return</font> h;
00427     }
00428 
00429     <font class="keywordtype">int</font> _validateMinute(<font class="keywordtype">int</font> m) {
00430       <font class="keywordflow">if</font>(m&lt;0 || m&gt;59) {
00431         this-&gt;_invalid(<font class="stringliteral">"minute"</font>,m);
00432       }
00433       <font class="keywordflow">return</font> m;
00434     }
00435 
00436     <font class="keywordtype">int</font> _validateSecond(<font class="keywordtype">int</font> s) {
00437       <font class="keywordflow">if</font>(s&lt;0 || s&gt;61) {
00438         this-&gt;_invalid(<font class="stringliteral">"second"</font>,s);
00439       }
00440       <font class="keywordflow">return</font> s;
00441     }
00442 
00443   <font class="keyword">public</font>:
<a name="l00445"></a><a class="code" href="classodbc_1_1_time.html#a0">00445</a>     Time(<font class="keywordtype">int</font> hour, <font class="keywordtype">int</font> minute, <font class="keywordtype">int</font> second) {
00446       this-&gt;setHour(hour);
00447       this-&gt;setMinute(minute);
00448       this-&gt;setSecond(second);
00449     }
00450 
00455     <font class="keyword">explicit</font> Time();
00456 
<a name="l00461"></a><a class="code" href="classodbc_1_1_time.html#a2">00461</a>     Time(std::time_t t) {
00462       this-&gt;setTime(t);
00463     }
00464 
<a name="l00469"></a><a class="code" href="classodbc_1_1_time.html#a3">00469</a>     Time(<font class="keyword">const</font> ODBCXX_STRING&amp; str) {
00470       this-&gt;parse(str);
00471     }
00472 
<a name="l00474"></a><a class="code" href="classodbc_1_1_time.html#a4">00474</a>     Time(<font class="keyword">const</font> Time&amp; t)
00475       :hour_(t.hour_),
00476        minute_(t.minute_),
00477        second_(t.second_) {}
00478 
<a name="l00480"></a><a class="code" href="classodbc_1_1_time.html#a5">00480</a>     Time&amp; operator=(<font class="keyword">const</font> Time&amp; t) {
00481       hour_=t.hour_;
00482       minute_=t.minute_;
00483       second_=t.second_;
00484       <font class="keywordflow">return</font> *<font class="keyword">this</font>;
00485     }
00486 
<a name="l00488"></a><a class="code" href="classodbc_1_1_time.html#a6">00488</a>     <font class="keyword">virtual</font> ~Time() {}
00489 
00491     <font class="keyword">virtual</font> <font class="keywordtype">void</font> setTime(std::time_t t);
00492 
00494     std::time_t getTime() <font class="keyword">const</font>;
00495 
00497     <font class="keywordtype">void</font> parse(<font class="keyword">const</font> ODBCXX_STRING&amp; str);
00498 
<a name="l00500"></a><a class="code" href="classodbc_1_1_time.html#a10">00500</a>     <font class="keywordtype">int</font> getHour()<font class="keyword"> const </font>{
00501       <font class="keywordflow">return</font> hour_;
00502     }
00503 
<a name="l00505"></a><a class="code" href="classodbc_1_1_time.html#a11">00505</a>     <font class="keywordtype">int</font> getMinute()<font class="keyword"> const </font>{
00506       <font class="keywordflow">return</font> minute_;
00507     }
00508 
<a name="l00510"></a><a class="code" href="classodbc_1_1_time.html#a12">00510</a>     <font class="keywordtype">int</font> getSecond()<font class="keyword"> const </font>{
00511       <font class="keywordflow">return</font> second_;
00512     }
00513 
<a name="l00515"></a><a class="code" href="classodbc_1_1_time.html#a13">00515</a>     <font class="keywordtype">void</font> setHour(<font class="keywordtype">int</font> h) {
00516       hour_=this-&gt;_validateHour(h);
00517     }
00518 
<a name="l00520"></a><a class="code" href="classodbc_1_1_time.html#a14">00520</a>     <font class="keywordtype">void</font> setMinute(<font class="keywordtype">int</font> m) {
00521       minute_=this-&gt;_validateMinute(m);
00522     }
00523 
<a name="l00525"></a><a class="code" href="classodbc_1_1_time.html#a15">00525</a>     <font class="keywordtype">void</font> setSecond(<font class="keywordtype">int</font> s) {
00526       second_=this-&gt;_validateSecond(s);
00527     }
00528 
00529     <font class="keyword">virtual</font> ODBCXX_STRING toString() <font class="keyword">const</font>;
00530   };
00531 
00532 
<a name="l00535"></a><a class="code" href="classodbc_1_1_timestamp.html">00535</a>   <font class="keyword">class </font>ODBCXX_EXPORT Timestamp : <font class="keyword">public</font> Date, <font class="keyword">public</font> Time {
00536   <font class="keyword">private</font>:
00537     <font class="keywordtype">int</font> nanos_;
00538     
00539     <font class="keyword">virtual</font> <font class="keywordtype">void</font> _invalid(<font class="keyword">const</font> <font class="keywordtype">char</font>* what, <font class="keywordtype">int</font> value);
00540 
00541     <font class="keywordtype">int</font> _validateNanos(<font class="keywordtype">int</font> n) {
00542       <font class="keywordflow">if</font>(n&lt;0) {
00543         this-&gt;_invalid(<font class="stringliteral">"nanoseconds"</font>,n);
00544       }
00545       <font class="keywordflow">return</font> n;
00546     }
00547 
00548   <font class="keyword">public</font>:
<a name="l00550"></a><a class="code" href="classodbc_1_1_timestamp.html#a0">00550</a>     Timestamp(<font class="keywordtype">int</font> year, <font class="keywordtype">int</font> month, <font class="keywordtype">int</font> day,
00551               <font class="keywordtype">int</font> hour, <font class="keywordtype">int</font> minute, <font class="keywordtype">int</font> second,
00552               <font class="keywordtype">int</font> nanos =0)
00553       :Date(year,month,day), Time(hour,minute,second) {
00554       this-&gt;setNanos(nanos);
00555     }
00556 
00561     <font class="keyword">explicit</font> Timestamp();
00562 
<a name="l00567"></a><a class="code" href="classodbc_1_1_timestamp.html#a2">00567</a>     Timestamp(std::time_t t) {
00568       this-&gt;setTime(t);
00569     }
00570 
<a name="l00575"></a><a class="code" href="classodbc_1_1_timestamp.html#a3">00575</a>     Timestamp(<font class="keyword">const</font> ODBCXX_STRING&amp; s) {
00576       this-&gt;parse(s);
00577     }
00578 
00579 
<a name="l00581"></a><a class="code" href="classodbc_1_1_timestamp.html#a4">00581</a>     Timestamp(<font class="keyword">const</font> Timestamp&amp; t)
00582       :Date(t),Time(t),nanos_(t.nanos_) {}
00583 
<a name="l00585"></a><a class="code" href="classodbc_1_1_timestamp.html#a5">00585</a>     Timestamp&amp; operator=(<font class="keyword">const</font> Timestamp&amp; t) {
00586       Date::operator=(t);
00587       Time::operator=(t);
00588       nanos_=t.nanos_;
00589       <font class="keywordflow">return</font> *<font class="keyword">this</font>;
00590     }
00591 
<a name="l00593"></a><a class="code" href="classodbc_1_1_timestamp.html#a6">00593</a>     <font class="keyword">virtual</font> ~Timestamp() {}
00594 
00596     <font class="keyword">virtual</font> <font class="keywordtype">void</font> setTime(std::time_t t);
00597     
<a name="l00599"></a><a class="code" href="classodbc_1_1_timestamp.html#a8">00599</a>     <font class="keyword">virtual</font> std::time_t getTime() {
00600       <font class="keywordflow">return</font> Date::getTime()+Time::getTime();
00601     }
00602 
00605     <font class="keywordtype">void</font> parse(<font class="keyword">const</font> ODBCXX_STRING&amp; s);
00606 
<a name="l00608"></a><a class="code" href="classodbc_1_1_timestamp.html#a10">00608</a>     <font class="keywordtype">int</font> getNanos()<font class="keyword"> const </font>{
00609       <font class="keywordflow">return</font> nanos_;
00610     }
00611 
<a name="l00613"></a><a class="code" href="classodbc_1_1_timestamp.html#a11">00613</a>     <font class="keywordtype">void</font> setNanos(<font class="keywordtype">int</font> nanos) {
00614       nanos_=this-&gt;_validateNanos(nanos);
00615     }
00616 
00617     <font class="keyword">virtual</font> ODBCXX_STRING toString() <font class="keyword">const</font>;
00618   };
00619 
00620 
00621   <font class="comment">//this is used for several 'lists of stuff' below</font>
00622   <font class="comment">//expects T to be a pointer-to-something, and</font>
00623   <font class="comment">//the contents will get deleted when the vector </font>
00624   <font class="comment">//itself is deleted</font>
00625   <font class="keyword">template</font> &lt;<font class="keyword">class</font> T&gt; <font class="keyword">class </font>CleanVector : <font class="keyword">public</font> std::vector&lt;T&gt; {
00626   <font class="keyword">private</font>:
00627     CleanVector(<font class="keyword">const</font> CleanVector&lt;T&gt;&amp;); <font class="comment">//forbid</font>
00628     CleanVector&lt;T&gt;&amp; operator=(<font class="keyword">const</font> CleanVector&lt;T&gt;&amp;); <font class="comment">//forbid</font>
00629 
00630   <font class="keyword">public</font>:
00631     <font class="keyword">explicit</font> CleanVector() {}
00632     <font class="keyword">virtual</font> ~CleanVector() {
00633       <font class="keyword">typename</font> std::vector&lt;T&gt;::iterator i=this-&gt;begin();
00634       <font class="keyword">typename</font> std::vector&lt;T&gt;::iterator end=this-&gt;end();
00635       <font class="keywordflow">while</font>(i!=end) {
00636         <font class="keyword">delete</font> *i;
00637         ++i;
00638       }
00639       this-&gt;clear();
00640     }
00641   };
00642 
00643 
<a name="l00646"></a><a class="code" href="classodbc_1_1_driver_message.html">00646</a>   <font class="keyword">class </font>ODBCXX_EXPORT DriverMessage {
00647     <font class="keyword">friend</font> <font class="keyword">class </font>ErrorHandler;
00648 
00649   <font class="keyword">private</font>:
00650     <font class="keywordtype">char</font> state_[SQL_SQLSTATE_SIZE+1];
00651     <font class="keywordtype">char</font> description_[SQL_MAX_MESSAGE_LENGTH];
00652     SQLINTEGER nativeCode_;
00653 
00654     DriverMessage() {}
00655 <font class="preprocessor">#if ODBCVER &lt; 0x0300</font>
00656 <font class="preprocessor"></font>    <font class="keyword">static</font> DriverMessage* fetchMessage(SQLHENV henv,
00657                                        SQLHDBC hdbc,
00658                                        SQLHSTMT hstmt);
00659 <font class="preprocessor">#else</font>
00660 <font class="preprocessor"></font>    <font class="keyword">static</font> DriverMessage* fetchMessage(SQLINTEGER handleType,
00661                                        SQLHANDLE h,
00662                                        <font class="keywordtype">int</font> idx);
00663 <font class="preprocessor">#endif</font>
00664 <font class="preprocessor"></font>
00665   <font class="keyword">public</font>:
00666     <font class="keyword">virtual</font> ~DriverMessage() {}
00667 
00668     <font class="keyword">const</font> <font class="keywordtype">char</font>* getSQLState()<font class="keyword"> const </font>{
00669       <font class="keywordflow">return</font> state_;
00670     }
00671 
00672     <font class="keyword">const</font> <font class="keywordtype">char</font>* getDescription()<font class="keyword"> const </font>{
00673       <font class="keywordflow">return</font> description_;
00674     }
00675 
00676     <font class="keywordtype">int</font> getNativeCode()<font class="keyword"> const </font>{
00677       <font class="keywordflow">return</font> nativeCode_;
00678     }
00679   };
00680 
00681   
<a name="l00684"></a><a class="code" href="classodbc_1_1_s_q_l_exception.html">00684</a>   <font class="keyword">class </font>SQLException : <font class="keyword">public</font> std::exception {
00685   <font class="keyword">private</font>:
00686     ODBCXX_STRING reason_;
00687     ODBCXX_STRING sqlState_;
00688     <font class="keywordtype">int</font> errorCode_;
00689 <font class="preprocessor">#if defined(ODBCXX_QT)</font>
00690 <font class="preprocessor"></font>    QCString reason8_;
00691 <font class="preprocessor">#endif</font>
00692 <font class="preprocessor"></font>    
00693   <font class="keyword">public</font>:
<a name="l00695"></a><a class="code" href="classodbc_1_1_s_q_l_exception.html#a0">00695</a>     <a class="code" href="classodbc_1_1_s_q_l_exception.html#a0">SQLException</a>(<font class="keyword">const</font> ODBCXX_STRING&amp; reason =<font class="stringliteral">""</font>, 
00696                  <font class="keyword">const</font> ODBCXX_STRING&amp; sqlState =<font class="stringliteral">""</font>,
00697                  <font class="keywordtype">int</font> vendorCode =0)
00698       :reason_(reason), 
00699        sqlState_(sqlState),
00700        errorCode_(vendorCode) 
00701 #if defined(ODBCXX_QT)
00702       ,reason8_(reason.local8Bit())
00703 #endif
00704 {}
00705 
<a name="l00707"></a><a class="code" href="classodbc_1_1_s_q_l_exception.html#a1">00707</a>     <a class="code" href="classodbc_1_1_s_q_l_exception.html#a0">SQLException</a>(<font class="keyword">const</font> DriverMessage&amp; dm)
00708       :reason_(dm.getDescription()),
00709        sqlState_(dm.<a class="code" href="classodbc_1_1_s_q_l_exception.html#a4">getSQLState</a>()),
00710        errorCode_(dm.getNativeCode()) {}
00711 
<a name="l00713"></a><a class="code" href="classodbc_1_1_s_q_l_exception.html#a2">00713</a>     <font class="keyword">virtual</font> <a class="code" href="classodbc_1_1_s_q_l_exception.html#a2">~SQLException</a>() <font class="keywordflow">throw</font>() {}
00714 
<a name="l00716"></a><a class="code" href="classodbc_1_1_s_q_l_exception.html#a3">00716</a>     <font class="keywordtype">int</font> <a class="code" href="classodbc_1_1_s_q_l_exception.html#a3">getErrorCode</a>()<font class="keyword"> const </font>{
00717       <font class="keywordflow">return</font> errorCode_;
00718     }
00719     
<a name="l00724"></a><a class="code" href="classodbc_1_1_s_q_l_exception.html#a4">00724</a>     <font class="keyword">const</font> ODBCXX_STRING&amp; <a class="code" href="classodbc_1_1_s_q_l_exception.html#a4">getSQLState</a>()<font class="keyword"> const </font>{
00725       <font class="keywordflow">return</font> sqlState_;
00726     }
00727     
<a name="l00729"></a><a class="code" href="classodbc_1_1_s_q_l_exception.html#a5">00729</a>     <font class="keyword">const</font> ODBCXX_STRING&amp; <a class="code" href="classodbc_1_1_s_q_l_exception.html#a5">getMessage</a>()<font class="keyword"> const </font>{
00730       <font class="keywordflow">return</font> reason_;
00731     }
00732 
00733 
<a name="l00735"></a><a class="code" href="classodbc_1_1_s_q_l_exception.html#a6">00735</a>     <font class="keyword">virtual</font> <font class="keyword">const</font> <font class="keywordtype">char</font>* <a class="code" href="classodbc_1_1_s_q_l_exception.html#a6">what</a>() <font class="keyword">const</font> <font class="keywordflow">throw</font>() {
00736       <font class="comment">// the conversion from QString involves a temporary, which</font>
00737       <font class="comment">// doesn't survive this scope. So here, we do a conditional</font>
00738 <font class="preprocessor">#if defined(ODBCXX_QT)</font>
00739 <font class="preprocessor"></font>      <font class="keywordflow">return</font> reason8_.data();
00740 <font class="preprocessor">#else</font>
00741 <font class="preprocessor"></font>      <font class="keywordflow">return</font> reason_.c_str();
00742 <font class="preprocessor">#endif</font>
00743 <font class="preprocessor"></font>    }
00744   };
00745 
00746 
<a name="l00751"></a><a class="code" href="classodbc_1_1_s_q_l_warning.html">00751</a>   <font class="keyword">class </font>SQLWarning : <font class="keyword">public</font> SQLException {
00752 
00753     <a class="code" href="classodbc_1_1_s_q_l_warning.html#a0">SQLWarning</a>(<font class="keyword">const</font> SQLWarning&amp;); <font class="comment">//forbid</font>
00754     SQLWarning&amp; operator=(<font class="keyword">const</font> SQLWarning&amp;); <font class="comment">//forbid</font>
00755 
00756   <font class="keyword">public</font>:
<a name="l00758"></a><a class="code" href="classodbc_1_1_s_q_l_warning.html#a0">00758</a>     <a class="code" href="classodbc_1_1_s_q_l_warning.html#a0">SQLWarning</a>(<font class="keyword">const</font> ODBCXX_STRING&amp; reason =<font class="stringliteral">""</font>,
00759                <font class="keyword">const</font> ODBCXX_STRING&amp; sqlState =<font class="stringliteral">""</font>,
00760                <font class="keywordtype">int</font> vendorCode =0)
00761       :<a class="code" href="classodbc_1_1_s_q_l_exception.html#a0">SQLException</a>(reason,sqlState,vendorCode) {}
00762     
<a name="l00764"></a><a class="code" href="classodbc_1_1_s_q_l_warning.html#a1">00764</a>     <a class="code" href="classodbc_1_1_s_q_l_warning.html#a0">SQLWarning</a>(<font class="keyword">const</font> DriverMessage&amp; dm)
00765       :<a class="code" href="classodbc_1_1_s_q_l_exception.html#a0">SQLException</a>(dm) {}
00766     
<a name="l00768"></a><a class="code" href="classodbc_1_1_s_q_l_warning.html#a2">00768</a>     <font class="keyword">virtual</font> <a class="code" href="classodbc_1_1_s_q_l_warning.html#a2">~SQLWarning</a>() <font class="keywordflow">throw</font>() {}
00769   };
00770 
00771   <font class="keyword">typedef</font> CleanVector&lt;SQLWarning*&gt; WarningList;
00772   
00773 
00774   <font class="keyword">template</font> &lt;<font class="keyword">class</font> T&gt; <font class="keyword">class </font>Deleter {
00775   <font class="keyword">private</font>:
00776     T* ptr_;
00777     <font class="keywordtype">bool</font> isArray_;
00778 
00779     Deleter(<font class="keyword">const</font> Deleter&lt;T&gt;&amp;);
00780     Deleter&lt;T&gt;&amp; operator=(<font class="keyword">const</font> Deleter&lt;T&gt;&amp;);
00781 
00782   <font class="keyword">public</font>:
00783     <font class="keyword">explicit</font> Deleter(T* ptr, <font class="keywordtype">bool</font> isArray =<font class="keyword">false</font>) 
00784       :ptr_(ptr), isArray_(isArray) {}
00785     ~Deleter() {
00786       <font class="keywordflow">if</font>(!isArray_) {
00787         <font class="keyword">delete</font> ptr_;
00788       } <font class="keywordflow">else</font> {
00789         <font class="keyword">delete</font>[] ptr_;
00790       }
00791     }
00792   };
00793 
00794 }; <font class="comment">// namespace odbc</font>
00795 
00796 
00797 <font class="preprocessor">#endif // __ODBCXX_TYPES_H</font>
</pre></div><hr>
<div align=center>
<a class=footer href="http://orcane.net/freeodbc++/">Go back to the freeodbc++ homepage</a>
</div>
